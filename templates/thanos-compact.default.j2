THANOS_COMPACT_OPTS="--log.level {{ thanos_arg.log_level }} --log.format {{ thanos_arg.log_format }} --http-address {{ ansible_default_ipv4.address }}:{{ thanos_port.compact_http }} --objstore.config-file {{ prometheus_data_path }}/thanos/bucket.yml --data-dir {{ prometheus_data_path }}/compact --retention.resolution-raw={{ thanos_obj_arg.retention }}d --retention.resolution-5m={{ thanos_obj_arg.retention }}d --retention.resolution-1h={{ thanos_obj_arg.retention }}d --wait --wait-interval={{ prometheus_arg.storage_tsdb_block_duration | default('2h') }} --compact.cleanup-interval={{ prometheus_arg.storage_tsdb_block_duration | default('2h') }} --compact.concurrency={{ (ansible_processor_vcpus * 0.5 + 1) | int }}"
